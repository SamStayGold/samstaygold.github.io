---
title: hdfs 建议参数
date: 2021-08-04 00:00:00 +0800
categories: [大数据, 存储]
tags: [hdfs]
---

# hdfs 建议参数


|      配置文件      |                           配置项                            |      默认      |                                                                                                                                                                                                                                                                                                                                                                                       建议                                                                                                                                                                                                                                                                                                                                                                                        | 含义                                                                                                                                                                   | 备注                                                                                                                                                                                                                                                          |
| :----------------: | :---------------------------------------------------------: | :------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  `hadoop-env.sh`   |                   `HADOOP_NAMENODE_OPTS`                    |                | `-server -Xms24g -Xmx24g -XX: UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction=3 -XX:CMSInitiatingOccupancyFraction=80 -Dhadoop.security.logger=${HADOOP_SECURITY_LOGGER:-INFO,RFAS} -Dhdfs.audit.logger=${HDFS_AUDIT_LOGGER:-INFO,NullAppender} -verbose:gc -XX: PrintGCDetails -XX: PrintGCTimeStamps -XX: PrintGCDateStamps -XX: PrintGCApplicationConcurrentTime -XX: PrintGCApplicationStoppedTime -XX: PrintHeapAtGC -XX: UseGCLogFileRotation -XX:NumberOfGCLogFiles=12 -XX:GCLogFileSize=1024M -Xloggc:${HADOOP_LOG_DIR:-/appcom/logs/hadoop}/namenode-gc.log.$(date  %Y%m%d%H%M%S) -XX: HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${HADOOP_LOG_DIR:-/appcom/logs/hadoop} -XX:ErrorFile=${HADOOP_LOG_DIR:-/appcom/logs/hadoop}/ps_err_pid%p.log $HADOOP_NAMENODE_OPTS` |
|  `core-site.xml`   |                    `io.file.buffer.size`                    |      4096      |                                                                                                                                                                                                                                                                                                                                                                                       65536                                                                                                                                                                                                                                                                                                                                                                                       | 用来设置缓存的大小。不论是对硬盘或者是网络操作来讲，较大的缓存都可以提供更高的数据传输，但这也就意味着更大的内存消耗和延迟。                                           | 这个参数要设置为系统页面大小的倍数，以byte为单位，默认值是4KB，一般情况下，可以设置为64KB（65536byte）                                                                                                                                                        |
|  `core-site.xml`   |               `ipc.server.listen.queue.size`                |      128       |                                                                                                                                                                                                                                                                                                                                                                                       2048                                                                                                                                                                                                                                                                                                                                                                                        | 定义服务器端接收客户端连接的监听队列长度                                                                                                                               | 与Linux参数net.core.somaxconn共同使用                                                                                                                                                                                                                         |
|  `core-site.xml`   |             `ha.health-monitor.rpc-timeout.ms`              |     45000      |                                                                                                                                                                                                                                                                                                                                                                                      180000                                                                                                                                                                                                                                                                                                                                                                                       | ZKFC检测NN状态未响应的超时时间，超过后ZKFC会强制停止active NN                                                                                                          |
|  `hdfs-site.xml`   |                `dfs.namenode.handler.count`                 |       10       |                                                                                                                                                                                                                                                                                                                                                                                     20*Ln(N)                                                                                                                                                                                                                                                                                                                                                                                      | NameNode有一个工作线程池用来处理客户端的远程过程调用及集群守护进程的调用。处理程序数量越多意味着要更大的池来处理来自不同DataNode的并发心跳以及客户端并发的元数据操作。 | 设置该值的一般原则是将其设置为集群大小的自然对数乘以20，即20ln(N)，N为集群大小。                                                                                                                                                                              |
|  `hdfs-site.xml`   |            `dfs.namenode.service.handler.count`             |       10       |                                                                                                                                                                                                                                                                                                                                                                                     20*Ln(N)                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                        | 设置该值的一般原则是将其设置为集群大小的自然对数乘以20，即20ln(N)，N为集群大小。                                                                                                                                                                              |
|  `hdfs-site.xml`   |        `dfs.namenode.fs-limits.max-component-length`        |      255       |                                                                                                                                                                                                                                                                                                                                                                                       1023                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                        |
|  `hdfs-site.xml`   |                `dfs.datanode.handler.count`                 |       10       |                                                                                                                                                                                                                                                                                                                                                                                        150                                                                                                                                                                                                                                                                                                                                                                                        | datanode上用于处理RPC的线程数                                                                                                                                          |
|  `hdfs-site.xml`   |           `dfs.datanode.balance.bandwidthPerSec`            | 1048576（1MB） |                                                                                                                                                                                                                                                                                                                                                                                 1073741824（1GB）                                                                                                                                                                                                                                                                                                                                                                                 | 数据均衡时的限速                                                                                                                                                       |
|  `hdfs-site.xml`   |         `dfs.datanode.balance.max.concurrent.moves`         |       5        |                                                                                                                                                                                                                                                                                                                                                                                        100                                                                                                                                                                                                                                                                                                                                                                                        | DN用于处理数据均衡的均衡线程数                                                                                                                                         |
|  `hdfs-site.xml`   |            `dfs.qjournal.write-txns.timeout.ms`             |     20000      |                                                                                                                                                                                                                                                                                                                                                                                       60000                                                                                                                                                                                                                                                                                                                                                                                       | NN写入JN超时时间，单位：毫秒                                                                                                                                           |
| `mapred-site.xml`  |                   mapreduce.map.java.opts                   |                |                                                                                                                                                                                                                                                                                                                                                              `-Xmx4G -XX: UseConcMarkSweepGC -Dfile.encoding=utf-8`                                                                                                                                                                                                                                                                                                                                                               | 设置默认为CMS GC；使用UTF-8编码格式                                                                                                                                    |
| `mapred-site.xml`  |                 mapreduce.reduce.java.opts                  |                |                                                                                                                                                                                                                                                                                                                                                              `-Xmx4G -XX: UseConcMarkSweepGC -Dfile.encoding=utf-8`                                                                                                                                                                                                                                                                                                                                                               | 设置默认为CMS GC；使用UTF-8编码格式                                                                                                                                    |
| `mapred-site.xml`  |         `mapreduce.client.submit.file.replication`          |       10       |                                                                                                                                                                                                                                                                                                                                                                                         3                                                                                                                                                                                                                                                                                                                                                                                         | 控制HDFS副本数，将输入数据放入更多DN上，尽可能实现本地化计算                                                                                                           | stagingArea/job_yyyyMMddHHmm_tttt/job.jar 执行job任务的那个jar文件  stagingArea/job_yyyyMMddHHmm_tttt/files 存储job的输入文件  stagingArea/job_yyyyMMddHHmm_tttt/libjars 与job相关的其它jar文件  stagingArea/job_yyyyMMddHHmm_tttt/archives job的archives文件 |
|   `yarn-env.sh`    |                 `YARN_RESOURCEMANAGER_OPTS`                 |                |                                                                                                                                        `-server -Xms4g -Xmx4g -XX: UseConcMarkSweepGC -XX:CMSFullGCsBeforeCompaction=3 -XX:CMSInitiatingOccupancyFraction=90 -verbose:gc -XX: PrintGCDetails -XX: PrintGCTimeStamps -XX: PrintGCDateStamps -XX: PrintGCApplicationConcurrentTime -XX: PrintGCApplicationStoppedTime -XX: PrintHeapAtGC -XX: UseGCLogFileRotation -XX:NumberOfGCLogFiles=12 -XX:GCLogFileSize=1024M -Xloggc:${HADOOP_LOG_DIR:-/appcom/logs/hadoop}/resourcemanager-gc.log.$(date  %Y%m%d%H%M%S) $YARN_RESOURCEMANAGER_OPTS`                                                                                                                                        |                                                                                                                                                                        |
|  `yarn-site.xml`   |         `yarn.resourcemanager.client.thread-count`          |       50       |                                                                                                                                                                                                                                                                                                                                                                                        90                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                        |
|  `yarn-site.xml`   |    `yarn.resourcemanager.scheduler.client.thread-count`     |       50       |                                                                                                                                                                                                                                                                                                                                                                                        90                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                        |
|  `yarn-site.xml`   | `yarn.resourcemanager.resource-tracker.client.thread-count` |       50       |                                                                                                                                                                                                                                                                                                                                                                                        90                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                        |
|  `yarn-site.xml`   |      `yarn.nodemanager.localizer.client.thread-count`       |       5        |                                                                                                                                                                                                                                                                                                                                                                                        10                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                        |
|  `yarn-site.xml`   |       `yarn.nodemanager.localizer.fetch.thread-count`       |       4        |                                                                                                                                                                                                                                                                                                                                                                                        10                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                        |
|  `yarn-site.xml`   |            `yarn.log-aggregation.retain-seconds`            |       -1       |                                                                                                                                                                                                                                                                                                                                                                                      172800                                                                                                                                                                                                                                                                                                                                                                                       | YARN聚合日志保留时间，只保留2天                                                                                                                                        |
|  `yarn-site.xml`   |      `yarn.resourcemanager.webapp.ui-actions.enabled`       |      true      |                                                                                                                                                                                                                                                                                                                                                                                       false                                                                                                                                                                                                                                                                                                                                                                                       | 控制是否可以在YARN页面停止任务                                                                                                                                         |
| `log4j.properties` |               `log4j.logger.BlockStateChange`               |      INFO      |                                                                                                                                                                                                                                                                                                                                                                                       WARN                                                                                                                                                                                                                                                                                                                                                                                        | normal block state change messages from BlockManager in NameNode.                                                                                                      |
| `log4j.properties` |      `log4j.logger.org.apache.hadoop.hdfs.StateChange`      |      INFO      |                                                                                                                                                                                                                                                                                                                                                                                       WARN                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                        |